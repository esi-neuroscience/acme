[tox]
envlist = py38-dask{2109,2110}-jobqueue{07}
requires = tox-conda
isolated_build = True

[testenv]
recreate = True
changedir = acme/tests
passenv = *
allowlist_externals = sh
deps =
    pytest
    jobqueue07: dask_jobqueue >= 0.7.1, < 0.8
# Force tox to install major package dependencies via conda to avoid building
# larger packages on POWER via pip
conda_deps=
    ipython
    tqdm >= 4.31
    numpy >= 1.0, < 2.0
    scipy
    h5py >= 2.9, < 3
    dask2109: dask >= 2021.09.0, < 2021.10
    dask2110: dask >= 2021.10.0, < 2021.11
    bokeh
conda_channels=
    defaults
    conda-forge
commands_pre =
    python -c "import sys; import subprocess; subprocess.run('chmod +x no_slurm.sh', shell=True, check=True) if sys.platform == 'linux' else print('not on linux')"
    python -c "import sys; import subprocess; subprocess.run('./no_slurm.sh', shell=True, check=True) if sys.platform == 'linux' else print('not on linux')"
commands =
    pytest
